define("service/ajax",["require","exports","module"],function(e,t){t.post=function(e,t,n){return n=n||{},t=t||{},$.ajax({url:e,data:t,method:"POST",type:"POST",dataType:"json",timeout:2e4,beforeSend:n.beforeSend||function(){var e=(new Date).getTime();n._time=e,n.holder&&n.holder.append('<div class="loading loading-'+e+'">').addClass("relative")},contentType:"application/x-www-form-urlencoded;charset=UTF-8",async:n.sync?!1:!0}).pipe(function(e){n.holder&&n.holder.removeClass("relative").find(".loading-"+n._time).remove();if(e.err_no===0)return e;if(e.err_no!==302){var i=$.Deferred();return i.reject(e),i.promise()}var t={online:"http://mis.diditaxi.com.cn/auth/sso/login?app_id=94",offline:"http://mis-test.diditaxi.com.cn/auth/sso/login?app_id=99"},r=encodeURIComponent(location.href);location.href=t.online+"&version=1.0&jumpto="+r})},t.jsonp=function(e,t,n){return $.ajax({url:e,data:t,dataType:"jsonp",timeout:n,scriptCharset:"UTF-8"}).pipe(function(e){if(e.err_no===0)return e;if(e.err_no!==302){var r=$.Deferred();return commonErrors[e.err_no]?r.reject(e):r.reject(e),r.promise()}var t={online:"http://mis.diditaxi.com.cn/auth/sso/login?app_id=94",offline:"http://mis-test.diditaxi.com.cn/auth/sso/login?app_id=99"},n=encodeURIComponent(location.href);location.href=t.online+"&version=1.0&jumpto="+n})}}),define("service/task-list",["require","exports","module","service/ajax"],function(e,t){var n=e("service/ajax");t.getTaskList=function(e){return n.post("/omega-compute/compute-api/get_task_list",e)},t.getHistoryTaskList=function(e){return n.post("/omega-compute/compute-api/get_task_history_list",e)},t.opTask=function(e){return n.post("/omega-compute/compute-api/operate_task",e)}}),define("css",["require"],function(e){var t={};return{load:function(e,n,r,i){if(typeof document=="undefined"){r();return}var s=document.getElementsByTagName("head")[0],o=n.toUrl(e);if(!t[o]){t[o]=1;var u=document.createElement("link");u.href=o,u.setAttribute("rel","stylesheet"),s.appendChild(u)}r()}}}),function(e,t){var n=t();typeof define=="function"?define("dep/class",[],function(){return n}):e.Class=n}(this,function(){"use strict";var e=function(){},t=function(e){return n(this.superClass,e)},n=function(e,t){while(e){var r=e.prototype[t];return r?r:n(e.prototype.superClass)}},r=function(e){return new this(e)},i={create:function(s,o){var u=null;i!==this&&(u=this),u===null?typeof s=="function"?u=s:(o=s,s=null):o||(o=s,s=null),o=o||{};var a=function(){for(var e in a.defaultOptions||{})this[e]||(this[e]=a.defaultOptions[e]);this.init.apply(this,arguments)};u&&(e.prototype=u.prototype,a.prototype=new e,e.prototype=null);for(var f in o)if(o.hasOwnProperty(f)){var l=o[f],c=!1;typeof l!="function"&&(c=l.override,l=l.handler),a.prototype[f]=function(e,t,r,i){return function(){if(!i){var s;t&&(s=n(t,r),s&&s.apply(this,arguments))}return e.apply(this,arguments)}}(l,u,f,c)}return u&&(a.prototype.superClass=u,a.prototype.constructor=a,a.prototype.getSuper=t),a.create=i.create,a.init=r,a}};return i.create({init:function(e){e=e||{};for(var t in e)this[t]=e[t]}})}),define("dep/eventable",["require","exports","module","./class"],function(e,t){var n=Array.prototype.slice;return e("./class").create({init:function(){this.eventMap={}},on:function(e,t){if(!e||!t)return!1;var n=this.eventMap[e];return n||(n=this.eventMap[e]=[]),n.push(t),function(){for(var e=0;e<n.length;e++)n[e]===t&&n.splice(e--,1)}},un:function(e,t){if(!e)return this.eventMap={},!0;var n=this.eventMap[e];if(!n)return!1;if(!t)return n.length=0,!0;var r=!1;for(var i=0;i<n.length;i++)n[i]===t&&(n.splice(i--,1),r=!0);return r},fire:function(e){var t=this.eventMap,r=n.call(arguments,1);setTimeout(function(){if(!e)return!1;var n=t[e];if(!n)return!1;var i=n.length;if(i===0)return!1;for(var s=0;s<n.length;s++)n[s].apply(null,r)},0)}})}),define("ui",["require","dep/eventable"],function(e){var t=e("dep/eventable").create({init:function(e){var t=this;this.element=$(this.element),this.on("init",function(){t.bindEvent&&t.bindEvent()}),this.fire("init",arguments)},dispose:function(){this.element.remove(),this.fire("dispose")}});return t}),Simplite.compiles["pager-template"]=function(e){return function(e){"use strict";var t=this,n='<ul class="pagination pagination-sm"><li class="pre-group';e.currentGroup<=1&&(n+=" disabled"),n+='"><a href="javascript:;" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>';var r=(e.currentGroup-1)*e.displayPageCount;for(var i=r+1;i<=r+e.displayPageCount;i++){if(i>e.totalPage)break;n+='<li class="'+t.defaultAttr(i==e.currentPage?"active":"page-btn")+'" data-page="'+t.defaultAttr(i)+'"><a href="javascript:;">'+t.defaultAttr(t.filter("format-length",i,e.totalPage))+"</a></li>"}return n+='<li class="next-group',e.currentGroup>=e.totalGroup&&(n+=" disabled"),n+='"><a href="javascript:;" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li></ul> ',n}.call(Simplite,e)},define("common/widgets/pager/pager",["require","css!./pager.less","ui"],function(e){e("css!./pager.less"),Simplite.addFilter("format-length",function(e,t){for(var n=(""+e).length,r=(""+t).length;n<r;n++)e="0"+e;return e});var t=e("ui").create({bindEvent:function(){var e=this;this.element.on("click",this.actions.preGroup,function(){e.toPreGroup($(this))}).on("click",this.actions.nextGroup,function(){e.toNextGroup($(this))}).on("click",this.actions.pageBtn,function(){e.toPage($(this).data("page"))})},render:function(e){$.extend(this,e),this.totalGroup=parseInt((this.totalPage-1)/this.displayPageCount)+1;var t=Simplite.render("pager-template",{currentPage:this.currentPage,pageSize:this.pageSize,totalPage:this.totalPage,displayPageCount:this.displayPageCount,currentGroup:this.currentGroup,totalGroup:this.totalGroup});this.element.html(t)},toPreGroup:function(e){if(e.hasClass("disabled"))return;this.currentGroup--,this.render()},toNextGroup:function(e){if(e.hasClass("disabled"))return;this.currentGroup++,this.render()},toPage:function(e){e=parseInt(e);if(isNaN(e))return;e<0&&(e=0),e>this.totalPage&&(e=this.totalPage),this.currentPage=e,this.currentGroup=parseInt((this.currentPage-1)/this.displayPageCount)+1,this.render(),this.fire("page",{currentPage:this.currentPage,pageSize:this.pageSize,currentGroup:this.currentGroup,totalPage:this.totalPage,displayPageCount:this.displayPageCount})}});return t.defaultOptions={actions:{pageBtn:".page-btn",preGroup:".pre-group",nextGroup:".next-group"},currentPage:1,pageSize:20,totalPage:1,displayPageCount:5,currentGroup:1,totalGroup:1},t}),define("common/utils",["require","exports","module"],function(e,t){t.deepCopy=function(e){var t,n=e.constructor;return function r(e,n,i){var s=e&&e.constructor,o,u,a,f,l=n===undefined;if(s===Object){o=l?t={}:n[i]={};for(u in e)r(e[u],o,u)}else if(s===Array){a=0,f=e.length,o=l?t=[]:n[i]=[];while(a<f)r(e[a],o,a++)}else if(s===Function)try{n[i]=(new Function("return "+e.toString()))()}catch(c){n[i]=e}else typeof e=="object"?n[i]=new s(e):n[i]=e}(e),t},t.getQuery=function(e){var t=location.search;if(!arguments.length){var n={};return t?(t.replace(/(?:\?|&)([^=]+)=([^&$]*)/g,function(e,t,r){n[t]=decodeURIComponent(r)}),n):n}var r=(new RegExp("[?&]"+e+"=([^&$]*)")).exec(t);return r&&decodeURIComponent(r[1])},t.format=function(e,t,n){return typeof e=="undefined"?"":(t=t||",",n=n||3,(""+e).replace(new RegExp("(\\d{1,"+n+"})(?=(\\d{"+n+"})+(?:$|\\.))","g"),"$1"+t))},t.parseToDate=function(e){return t.toDate(t.parseToTimestamp(e))},t.parseToTimestamp=function(e){return Date.parse(e.replace(/\-/g,"/"))},t.addDay=function(e,n){var r=t.toDate(t.toTimestamp(e));return r.setDate(r.getDate()+n),r},t.toYMD=function(e){var t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate();return n<10&&(n="0"+n),r<10&&(r="0"+r),t+"-"+n+"-"+r},t.toYMDHMS=function(e){var t=e.getFullYear(),n=e.getMonth()+1,r=e.getDate(),i=e.getHours(),s=e.getMinutes(),o=e.getSeconds();return n<10&&(n="0"+n),r<10&&(r="0"+r),i<10&&(i="0"+i),s<10&&(s="0"+s),o<10&&(o="0"+o),t+"-"+n+"-"+r+" "+i+":"+s+":"+o},t.toTimestamp=function(e){return e.getTime()},t.toDate=function(e){return new Date(e)},t.compareTo=function(e,n){return t.toTimestamp(e)-t.toTimestamp(n)},t.offsetOfWeek=function(e){return(e.getDay()||7)-1},t.firstOfWeek=function(e){return t.addDay(e,-t.offsetOfWeek(e))},t.getFormData=function(e,t){var n={};return t=t||"[name]",e.find(t).each(function(){n[this.name]=this.value}),n};var n=t.formatJSON=function(e,t,r){if(null==e)return""+e;r=r||"";var i=e.constructor;if(i===String)return t?'<span class="json-string-value">"'+e+'"</span>':'"'+e+'"';if(i===Number)return t?'<span class="json-number-value">'+e+"</span>":e;if(i===Array){var s=t?'<span class="json-array-tag">[</span>\n':"[\n";for(var o=0,u=e.length;o<u-1;o++)s+=r+"	"+n(e[o],t,r+"	")+",\n";return s+=r+"	"+n(e[u-1],t,r+"	")+"\n",s+r+(t?'<span class="json-array-tag">]</span>':"]")}if(i===Object){var a=t?'<span class="json-object-tag">{</span>\n':"{\n",f=!0;for(var l in e)f=!1,a+=r+"	"+(t?'<span class="json-object-key">"'+l+'"'+"</span>":'"'+l+'"')+": "+n(e[l],t,r+"	")+",\n";return f||(a=a.slice(0,-2)),a+"\n"+r+(t?'<span class="json-object-tag">}</span>':"}")}}}),define("task-list/task-list",["require","exports","module","service/task-list","common/widgets/pager/pager","common/utils"],function(e,t){var n=e("service/task-list"),r=e("common/widgets/pager/pager"),i=e("common/utils"),s=i.getQuery("vh"),o=i.getQuery("id"),u={start:'<button class="btn btn-primary btn-xs task-start" type="button">启动</button>',stop:'<button class="btn btn-danger btn-xs task-stop" type="button">停止</button>',edit:'<button class="btn btn-primary btn-xs task-edit" type="button">编辑</button>',copy:'<button class="btn btn-primary btn-xs task-copy" type="button">复制</button>',task_detail:'<a class="btn btn-primary btn-xs" href="/task/list?id=${taskid}&vh=1">查看任务</a>',result_detail:'<a class="btn btn-primary btn-xs" target="_blank" href="/task/result?id=${taskid}&hid=${historyid}">查看结果</a>'};Simplite.addFilter("getActions",function(e){var t=e.actions||[],n=[];for(var r=0,i=t.length;r<i;r++)n.push(u[t[r]].replace(/\$\{([^\}]+)\}/g,function(t,n){return e[n]}));return n.join(" | ")});var a=function(e,t,r){var i;return s?i=n.getHistoryTaskList(e):i=n.getTaskList(e),i.done(function(n){var i=n.data;i.vh=s;var o=Simplite.render("task-list-task-list-tbody",i);t.find(".task-tbody").html(o);var u=i.total_size,a=parseInt((u-1)/e.pagesize)+1;t.find(".page-count").text(a),r.render({currentPage:+e.currentpage,totalPage:a})})};t.init=function(){var e=this.element,t={currentpage:1,pagesize:20};s&&(t.taskid=o);var i=Simplite.render("task-list-task-list",{vh:s});e.html(i);var u=r.init({element:e.find(".pager-container"),displayPageCount:15});u.on("page",function(n){t.currentpage=n.currentPage,a(t,e,u)}),a(t,e,u),e.on("click",".task-start",function(){n.opTask({taskid:$(this).parent().data("id"),type:"start"}).done(function(e){window.location.reload(!0)}).fail(function(e){alert(e.err_msg)})}).on("click",".task-stop",function(){n.opTask({taskid:$(this).parent().data("id"),type:"stop"}).done(function(e){window.location.reload(!0)}).fail(function(e){alert(e.err_msg)})}).on("click",".task-edit",function(){window.location.href=window.rootBase+"/task/add?id="+$(this).parent().data("id")}).on("click",".task-copy",function(){window.location.href=window.rootBase+"/task/add?cp=1&id="+$(this).parent().data("id")})}}),Simplite.compiles["task-list-task-list"]=function(e){return function(e){"use strict";var t=this,n='<div class="row task-list"><div class="item-title">任务列表</div><div class="row item-body"><div class="task-table"><table class="table table-hover table-bordered"><thead><tr><th>操作</th>';return e.vh&&(n+="<th>历史id</th>"),n+='<th>任务id</th><th>创建人</th><th>任务描述</th><th>计算模型</th><th>启动时间</th><th>结束时间</th><th>状态</th></tr></thead><tbody class="task-tbody"></tbody></table><div class="pager-container"></div></div></div></div> ',n}.call(Simplite,e)},Simplite.compiles["task-list-task-list-tbody"]=function(e){return function(e){"use strict";var t=this,n="";for(var r=0,i=e.list.length;r<i;r++){var s=e.list[r];n+='<tr><td data-id="'+t.defaultAttr(s.taskid)+'" data-hid="'+t.defaultAttr(s.historyid)+'">'+t.defaultAttr(t.filter("getActions",s))+"</td>",e.vh&&(n+="<td>"+t.defaultAttr(s.historyid)+"</td>"),n+="<td>"+t.defaultAttr(s.taskid)+"</td><td>"+t.defaultAttr(s.owner)+"</td><td>"+t.defaultAttr(s.descr)+"</td><td>"+t.defaultAttr(s.compute_name)+"</td><td>"+t.defaultAttr(t.filter("dateFormat",s.start_time))+"</td><td>"+t.defaultAttr(t.filter("dateFormat",s.end_time))+"</td><td>"+t.defaultAttr(s.status)+"</td></tr>"}return n+=" ",n}.call(Simplite,e)},define("task-list/main",["require","exports","module","./task-list","common/utils"],function(e,t){e("./task-list");var n=e("common/utils");Simplite.addFilter("dateFormat",function(e){return n.toYMDHMS(n.toDate(e))})});