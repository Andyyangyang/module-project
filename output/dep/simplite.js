!function(t,e){var r=e();"function"==typeof define?define(function(){return r}):"undefined"==typeof require?t.Simplite=r:module.exports=r}(this,function(){"use strict";var t=Array.prototype.slice,e=function(t,e){for(var r in t)e[r]||(e[r]=t[r]);return e},r=function(t){return t=t||{},{logicOpenTag:t.logicOpenTag||"<%",logicCloseTag:t.logicCloseTag||"%>",attrOpenTag:t.attrOpenTag||"<%=",attrCloseTag:t.attrCloseTag||"%>",dataKey:t.dataKey||"_this",compiles:{},templates:{},filters:t.filters||{escape:function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","\\":"\\\\"},e=/\\|&|<|>|"|'/g;return function(r){return"undefined"==typeof r?"":"string"!=typeof r?r:r.replace(e,function(e){return t[e]})}}()}}},n=function(t){e(r(t),this)};e(r(),n),n.addFilter=function(t,e,r){(r||n).filters[t]=e},n.getFilter=function(t,e){return(e||n).filters[t]},n.addTemplate=function(t,e,r){(r||n).templates[t]=e},n.filter=function(e){return this.filters[e].apply(this,t.call(arguments,1))},n.include=function(t,e){var r=arguments.length;if(r>2){var i=arguments[r-1];e={};for(var o=1;r-1>o;o++){var a=arguments[o];if(null!=a)if(a.constructor===Object)for(var l in a)e[l]=a[l];else e=a}if(e.constructor===Object&&null!=i&&i.constructor===Object)for(var l in i)e.hasOwnProperty(l)||(e[l]=i[l])}return n.render(t,e,this)};var i=/(^|[^\s])\s*(include|filter)\s*\(([^;]+)\)/g,o=/^\s*filter\(/g,a=/"/g,l=/\n/g,c=/(?:(["'])[\s\S]*?\1)|(?:\/\/.*\n)|(?:\/\*([\s\S])*?\*\/)|(?:\>\s+\<)|(?:\s+)/g,u=function(t){var e=t.charAt(0);switch(e){case"/":return"";case'"':case"'":return t;case">":return"><";default:return" "}},g=function(t,e){return"#"===e.charAt(0)?'"+_t.defaultAttr(_t.filter("escape",'+e.slice(1).replace(o,"_t.filter(")+'))+"':'"+_t.defaultAttr('+e.replace(o,"_t.filter(")+')+"'},s=function(t){return t.replace(a,'\\"').replace(l,"\\n")};return n.compile=function(t,e){e=e||n;var r=e.attrTagReg,i=e.logicOpenTagReg,o=e.logicCloseTagReg,a=e.htmlReg;r||(r=e.attrTagReg=new RegExp(e.attrOpenTag+"([\\s\\S]+?)"+e.attrCloseTag,"g"),i=e.logicOpenTagReg=new RegExp("(?=\\s?)"+e.logicOpenTag+"\\s?","g"),o=e.logicCloseTagReg=new RegExp("\\s?"+e.logicCloseTag+"(?=\\s?)","g"),a=e.htmlReg=new RegExp("(?:"+e.logicCloseTag+"|^)(?:(?!"+e.logicOpenTag+")[\\s\\S])+?(?:$|"+e.logicOpenTag+")","g"));try{var l=new Function(e.dataKey,e.toCodeBlock(e.templates[t],e));return function(t){return l.call(e,t)}}catch(c){throw c}},n.render=function(t,e,r){r=r||n;var i=r.compiles[t];return i||(i=r.compiles[t]=n.compile(t,r)),i(e)},n.toCodeBlock=function(t,e){var r=function(t,r,n,i){return"."===r?t:(r||"")+" _o+=_t."+n+"("+i+","+e.dataKey+")\n"};e=e||n;var o=t.replace(c,u).replace(e.htmlReg,s).replace(e.attrTagReg,g).replace(e.logicOpenTagReg,'";').replace(e.logicCloseTagReg,'\n_o+="').replace(i,r);return'"use strict"\nvar _t=this,_o="'+o+'";return _o;'},n.defaultAttr=function(t){return null==t?"":t},n.prototype.compile=function(t){return n.compile(t,this)},n.prototype.render=function(t,e){return n.render(t,e,this)},n.prototype.addFilter=function(t,e){n.addFilter(t,e,this)},n.prototype.getFilter=function(t){return n.getFilter(t,this)},n.prototype.addTemplate=function(t,e){n.addTemplate(t,e,this)},n.prototype.filter=function(t){return n.filter.apply(this,arguments)},n.prototype.include=function(t,e){return n.include.apply(this,arguments)},n.prototype.defaultAttr=function(t){return n.defaultAttr(t)},n});