define("service/commonErrors",["require","exports","module"],function(e,t){"use strict";t[100001]="数据库连接错误",t[100002]="数据库查询错误",t[100003]="请求参数错误";var n=function(e){}}),define("service/ajax",["require","exports","module","./commonErrors"],function(e,t){var n=e("./commonErrors"),r=/\{([^\}]+)\}/g,i=[];$(window).bind("beforeunload",function(){$.each(i,function(e,t){t&&t.abort()})});var s=function(e){for(var t in e)if(e[t]&&e[t].constructor===File)return!0;return!1},o=function(e){var t=new FormData;for(var n in e)t.append(n,e[n]);return t};t.post=function(e,t,n){t=t||{},n=n||{};var u=e,a=!1;e=e.replace(r,function(e,n){return a=!0,t[n]}),a&&(t.__url__=u),e=window.rootBase+e;var f={url:e,data:t,method:"POST",type:"POST",dataType:"json",cache:!1,timeout:2e4,beforeSend:n.beforeSend||function(){var e=n.holder;if(e){var t=e.children(".data-loading");t[0]?t.data("count",+t.data("count")+1):(t=$('<div class="data-loading data-loading" data-count="1">'),e.append(t)),e.css("position")==="static"&&!e.hasClass("data-loading-relative")&&e.addClass("data-loading-relative")}},contentType:"application/x-www-form-urlencoded;charset=UTF-8",async:n.sync?!1:!0};n.headers&&(f.headers=n.headers),s(t)&&(f.data=o(t),f.contentType=!1,f.processData=!1);var l=$.ajax(f);return i.push(l),l.pipe(function(e){var t=n.holder;if(t){var r=t.children(".data-loading"),i=+r.data("count");i>1?r.data("count",i-1):t.removeClass("data-loading-relative").find(".data-loading").remove()}if(e.status===200)return e;if(e.status===302)window.location.href=window.rootBase+"/login";else{if(e.status!==403){var s=$.Deferred();return s.reject(e),s.promise()}alert("你还没有此权限，马上去申请权限~")}}).fail(function(e){e.status!==200&&e.statusText&&console.log(e.statusText)}).always(function(){for(var e=0;e<i.length;e++)i[e]===l&&i.splice(e--,1)})},t.jsonp=function(e,t,r){return $.ajax({url:e,data:JSON.stringify(t),dataType:"jsonp",timeout:r,scriptCharset:"UTF-8"}).pipe(function(e){if(e.status===200)return e;var t=$.Deferred();return n[e.status]?t.reject(e):t.reject(e),t.promise()})}}),define("service/web-pagelist",["require","exports","module","service/ajax"],function(e,t){var n=e("service/ajax");t.getProducts=function(e){return n.post("/compute-api/web/productlist",e)},t.getPageList=function(e){return n.post("/compute-api/web/pagelist",e)}}),define("dep/eventEmitter",["require","exports","module"],function(e,t){var n=Array.prototype.slice,r=function(){this.tasks={},this.fired={}};return r.tasks={},r.fired={},r.on=r.prototype.on=function(e,t){if(!e||!t)return!1;var n=this.tasks[e];if(!n){n=this.tasks[e]=[];var r=this.fired[e];r&&t.apply(null,r)}return n.push(t),function(){for(var e=0;e<n.length;e++)n[e]===t&&n.splice(e--,1)}},r.fire=r.prototype.fire=function(e){var t=this.tasks,r=n.call(arguments,1);if(!e)return!1;this.fired[e]=r;var i=t[e];if(!i)return!1;var s=i.length;if(s===0)return!1;for(var o=0;o<i.length;o++)i[o].apply(null,r)},r.un=r.prototype.un=function(e,t){if(!e)return this.tasks={},!0;var n=this.tasks[e];if(!n)return!1;if(!t)return n.length=0,!0;var r=!1;for(var i=0;i<n.length;i++)n[i]===t&&(n.splice(i--,1),r=!0);return r},r.once=r.prototype.once=function(e,t){var n=this,r=function(){t.apply(null,arguments),n.un(e,r)};this.on(e,r)},r.init=function(){return new r},r}),function(e,t){var n=t();typeof define=="function"?define("dep/class",[],function(){return n}):e.Class=n}(this,function(){"use strict";var e=function(){},t=function(e){return n(this.superClass,e)},n=function(e,t){while(e){var r=e.prototype[t];return r?r:n(e.prototype.superClass)}},r=function(e){return new this(e)},i={create:function(s,o){var u=null;i!==this&&(u=this),u===null?typeof s=="function"?u=s:(o=s,s=null):o||(o=s,s=null),o=o||{};var a=function(){for(var e in a.defaultOptions||{})this[e]||(this[e]=a.defaultOptions[e]);this.init.apply(this,arguments)};u&&(e.prototype=u.prototype,a.prototype=new e,e.prototype=null);for(var f in o)if(o.hasOwnProperty(f)){var l=o[f],c=!1;typeof l!="function"&&(c=l.override,l=l.handler),a.prototype[f]=function(e,t,r,i){return function(){if(!i){var s;t&&(s=n(t,r),s&&s.apply(this,arguments))}return e.apply(this,arguments)}}(l,u,f,c)}return u&&(a.prototype.superClass=u,a.prototype.constructor=a,a.prototype.getSuper=t),a.create=i.create,a.init=r,a}};return i.create({init:function(e){e=e||{};for(var t in e)this[t]=e[t]}})}),define("dep/eventable",["require","exports","module","./class","./eventEmitter"],function(e,t){var n=Array.prototype.slice;return e("./class").create({init:function(){var t=e("./eventEmitter").init();this.tasks=t.tasks,this.fired=t.fired,this.on=t.on,this.un=t.un,this.fire=function(){var e=arguments;setTimeout(function(){t.fire.apply(t,e)},0)}}})}),define("component/ui",["require","dep/eventable"],function(e){var t=e("dep/eventable").create({init:function(e){var t=this;this.element=$(this.element),this.on("init",function(){t.bindEvent&&t.bindEvent()}),this.fire("init",arguments)},dispose:function(){this.element.remove(),this.fire("dispose")}});return t}),Simplite.compiles["dropdown-template"]=function(e){return function(e){"use strict";var t=this,n='<div class="'+t.defaultAttr(e.dropup?"dropup":"dropdown")+'"><button class="btn btn-default dropdown-toggle'+t.defaultAttr(e.size?" "+e.size:"")+'" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><span class="selected-item" data-val="">'+t.defaultAttr(e.defaultText)+'</span><span class="caret"></span>';return e.name&&(n+='<input type="hidden" name="'+t.defaultAttr(e.name)+'" value="'+t.defaultAttr(e.value)+'"/>'),n+='</button><ul class="dropdown-menu"'+t.defaultAttr(e.height?' style="max-height:'+e.height+'px;overflow-y:auto;"':"")+">",e.filterable&&e.list.length&&(n+='<li class="search-container"><input type="text" class="form-control input-sm" placeholder="筛选列表数据"></li>'),n+="",n+=t.include("dropdown-template-item",e,e),n+="</ul> ",n}.call(Simplite,e)},Simplite.compiles["dropdown-template-item"]=function(e){return function(e){"use strict";var t=this,n="",r=e.list.length;for(var i=0;i<r;i++){var s=e.list[i];n+='<li class="dropdown-item'+t.defaultAttr(e.value==s.id?" active":"")+'" ';for(var o in s)typeof s[o]!="object"&&(n+=" data-"+t.defaultAttr(o)+'="'+t.defaultAttr(t.filter("escape",s[o]))+'" ');n+=" "+t.defaultAttr(s.tip?'title="'+s.tip+'" data-toggle="tooltip"':"")+'><a href="javascript:;">'+t.defaultAttr(s.text)+"</a></li>"}return n+=" ",n}.call(Simplite,e)},define("component/widgets/dropdown/dropdown",["require","../../ui"],function(e){(function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML="@import './a.less'; .dropdown-widget { &.disabled { .dropdown-toggle { background-color: #e6e6e6; } } .dropdown, .dropup { & > .btn { width: 100%; text-align: left; padding-right: 26px; } } .dropdown-menu { min-width: 100%; } .search-container { padding: 0 10px 5px 10px; } .caret { position: absolute; top: 50%; right: 12px; } }",e.appendChild(t)})();var t=function(e,t){if(e[0]){var n=e.siblings(".active");if(n[0]!==e[0]){var r=e.data();n.removeClass("active"),e.addClass("active"),t.element.find(".selected-item").data(r).html(t.renderItem(r)),t.name&&t.element.find('[name="'+t.name+'"]').val(r.id)}}else t.element.find(".active").removeClass("active"),t.element.find(".selected-item").data("id","").html(t.defaultText)},n=e("../../ui").create({init:function(){this.element.addClass("dropdown-widget"),this.value=this.value||this.element.data("id"),this.render(this.data,this.value)},bindEvent:function(){var e=this;this.element.on("click",".dropdown-item",function(){var n=$(this);t(n,e),e.fire("change",n.data())}).on("click",function(){if($(this).hasClass("disabled"))return!1}).on("input",".search-container > :text",function(e){var t=$.trim(this.value);$(this).parent().nextAll().each(function(){var e=$(this).data("text")+"";e.indexOf(t)>-1?$(this).show():$(this).hide()})})},render:function(e,t){t=t||this.value;var n=Simplite.render("dropdown-template",$.extend(this,{list:e||[],value:t}));this.element.html(n),t!=null&&this.setVal(t)},setData:function(e){var t=this,n=Simplite.render("dropdown-template-item",$.extend(this,e||[]));this.element.find(".dropdown-menu").html(n),this.value&&this.setVal(this.value)},setVal:function(e){t(this.element.find('.dropdown-item[data-id="'+e+'"]'),this)},getVal:function(){return this.getItem().id},getItem:function(){return this.element.find(".selected-item").data()},renderItem:function(e){return e.text},setDisabled:function(e){e!==!1?this.element.addClass("disabled"):this.element.removeClass("disabled")},find:function(e){return this.element.find(e)}});return n.defaultOptions={defaultText:"请选择"},n}),define("web-pagelist/filters",["require","exports","module","service/web-pagelist","dep/eventEmitter","component/widgets/dropdown/dropdown"],function(e,t){"use strict";var n=e("service/web-pagelist"),r=e("dep/eventEmitter"),i=e("component/widgets/dropdown/dropdown"),s=moment().add(-14,"days").startOf("day"),o=moment().add(-1,"days").startOf("day");t.init=function(){var e={product:"",start_date:s.format("YYYY-MM-DD"),end_date:o.format("YYYY-MM-DD")},t=this.element;n.getProducts().done(function(n){var u=Simplite.render("web-pagelist-filters",$.extend(!0,{},e,n.data));t.html(u);var a=i.init({element:t.find(".dropdown"),defaultText:"请选择产品"});a.on("change",function(t){e.product=t.id,r.fire("web-pagelist-filters-change",e)});var f=n.data.list,l=[];$.each(f,function(e,t){l.push({id:t,text:t})}),a.render(l),t.find("#date-range").daterangepicker({startDate:s,endDate:o,timePicker:!1,timePicker12Hour:!1,linkedCalendars:!0,separator:" 到 ",format:"YYYY-MM-DD",opens:"right",ranges:{"近1天":[moment().subtract(1,"days"),moment().subtract(1,"days")],"近15天":[moment().subtract(15,"days"),moment().subtract(1,"days")],"近30天":[moment().subtract(30,"days"),moment().subtract(1,"days")]},locale:{applyLabel:"确定",cancelLabel:"取消",fromLabel:"开始时间",toLabel:"结束时间",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]}},function(t,n,i){var s=t.format("YYYY-MM-DD"),o=n.format("YYYY-MM-DD");e.start_date=s,e.end_date=o,r.fire("web-pagelist-filters-change",e)})}),t.on("click",".dialog",function(){r.fire("web-pagelist-filters-dialog")}),r.fire("web-pagelist-filters-change",e)}}),Simplite.compiles["pager-template"]=function(e){return function(e){"use strict";var t=this,n='<ul class="pagination"><li class="pre-group';e.currentGroup<=1&&(n+=" disabled"),n+='"><a href="javascript:;" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>';var r=(e.currentGroup-1)*e.displayPageCount;for(var i=r+1;i<=r+e.displayPageCount;i++){if(i>e.totalPage)break;n+='<li class="'+t.defaultAttr(i==e.currentPage?"active":"page-btn")+'" data-page="'+t.defaultAttr(i)+'"><a href="javascript:;">'+t.defaultAttr(t.filter("format-length",i,e.totalPage))+"</a></li>"}return n+='<li class="next-group',e.currentGroup>=e.totalGroup&&(n+=" disabled"),n+='"><a href="javascript:;" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li></ul> ',n}.call(Simplite,e)},define("component/widgets/pager/pager",["require","../../ui"],function(e){(function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=".pager-widget ul.pagination { margin: 0; } ",e.appendChild(t)})(),Simplite.addFilter("format-length",function(e,t){return e});var t=e("../../ui").create({init:function(){this.element.addClass("pager-widget")},bindEvent:function(){var e=this;this.element.on("click",this.actions.preGroup,function(){e.toPreGroup($(this))}).on("click",this.actions.nextGroup,function(){e.toNextGroup($(this))}).on("click",this.actions.pageBtn,function(){e.toPage($(this).data("page"))})},render:function(e){$.extend(this,e),this.totalGroup=parseInt((this.totalPage-1)/this.displayPageCount)+1;var t=Simplite.render("pager-template",{currentPage:this.currentPage,pageSize:this.pageSize,totalPage:this.totalPage,displayPageCount:this.displayPageCount,currentGroup:this.currentGroup,totalGroup:this.totalGroup});this.element.html(t)},toPreGroup:function(e){if(e.hasClass("disabled"))return;this.currentGroup--,this.render()},toNextGroup:function(e){if(e.hasClass("disabled"))return;this.currentGroup++,this.render()},toPage:function(e){e=parseInt(e);if(isNaN(e))return;e<0&&(e=0),e>this.totalPage&&(e=this.totalPage),this.currentPage=e,this.currentGroup=parseInt((this.currentPage-1)/this.displayPageCount)+1,this.render(),this.fire("page",{currentPage:this.currentPage,pageSize:this.pageSize,currentGroup:this.currentGroup,totalPage:this.totalPage,displayPageCount:this.displayPageCount})}});return t.defaultOptions={actions:{pageBtn:".page-btn",preGroup:".pre-group",nextGroup:".next-group"},currentPage:1,pageSize:20,totalPage:1,displayPageCount:10,currentGroup:1,totalGroup:1},t}),Simplite.compiles["dialog-template"]=function(e){return function(e){"use strict";var t=this,n='<div class="modal'+t.defaultAttr(e.nofade?"":" fade")+""+t.defaultAttr(e.cls?" "+e.cls:"")+'"><div class="modal-dialog"'+t.defaultAttr(e.width?' style="width:'+e.width+'px;"':"")+'><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title">'+t.defaultAttr(e.title)+'</h4></div><div class="modal-body"> '+t.defaultAttr(e.content)+" </div>",r=e.actions&&e.actions.length;if(r){n+='<div class="modal-footer">';for(var i=0;i<r;i++){var s=e.actions[i];n+='<button type="button" ',s==="cancel"?n+=' class="btn btn-default cancel" data-dismiss="modal" ':n+=' class="btn btn-primary ok" ',n+=" >"+t.defaultAttr(e.buttons[s].text)+"</button>"}n+="</div>"}return n+="</div></div></div> ",n}.call(Simplite,e)},define("component/widgets/dialog/dialog",["require","../../ui"],function(e){(function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=".dialog-widget { top: 50px; } ",e.appendChild(t)})();var t=e("../../ui").create({init:function(){this.context=$(this.context),this.render(this.data)},bindEvent:function(){var e=this;this.dialog.on("click",".ok",function(t){e.fire("ok")}),this.dialog.on("click",".cancel",function(){e.fire("cancel")}),this.dialog.on("click",".close",function(){e.fire("cancel")})},render:function(e){e=$.extend(e,this);var t=this.dialog=$(Simplite.render("dialog-template",e));this.context.append(t),t.addClass("dialog-widget")},show:function(){this.dialog.modal({show:!0,backdrop:"static"})},hide:function(){this.dialog.modal("hide")},setTitle:function(e){this.dialog.find(".modal-title").html(e)},setContent:function(e){this.dialog.find(".modal-body").html(e)},find:function(e){return this.dialog.find(e)},destroy:function(){this.dialog.remove(),$(".modal-backdrop").remove()}});return t.defaultOptions={context:"body",actions:["ok","cancel"],buttons:{ok:{text:"确定"},cancel:{text:"取消"}}},t}),define("web-pagelist/list",["require","exports","module","service/web-pagelist","dep/eventEmitter","component/widgets/pager/pager","component/widgets/dialog/dialog"],function(e,t){"use strict";var n=e("service/web-pagelist"),r=e("dep/eventEmitter"),i=e("component/widgets/pager/pager"),s=e("component/widgets/dialog/dialog"),o={current_page:0,page_size:10},u=function(e,t,r){$.extend(!0,o,r);if(!r.product)return;n.getPageList(o).done(function(n){var r=Simplite.render("web-pagelist-list-tbody",n.data);e.find("tbody").html(r);var i=n.data.total,s=o.page_size,u=parseInt((i-1)/s)+1;t.render({currentPage:o.current_page+1,totalPage:u})})};t.init=function(){var e=this.element,t=Simplite.render("web-pagelist-list");e.html(t);var n=i.init({element:e.find(".widgets-pager")}),a=s.init({data:{title:"弹窗标题",content:"弹窗内容"}});a.on("ok",function(){a.hide()}),e.on("click",".trend",function(e){e.stopPropagation();var t=$(this).data("href"),n=$(this).data("url"),r=o.start_date,i=o.end_date;window.open(t+"?start_date="+r+"&end_date="+i+"&url="+encodeURIComponent(n))}),n.on("page",function(t){o.current_page=t.currentPage-1,u(e,n)}),r.on("web-pagelist-filters-change",function(t){u(e,n,t)}),r.on("web-pagelist-filters-dialog",function(){a.show(),setTimeout(function(){a.setTitle("标题可以动态设置"),a.setContent("内容可以动态设置")},1e3)})}}),Simplite.compiles["web-pagelist"]=function(e){return function(e){"use strict";var t=this,n='<div><div class="module-block"><div class="block-title">页面分析</div><div class="block-content"><div class="filters" data-module-path="web-pagelist/filters"></div><div class="list" data-module-path="web-pagelist/list"></div></div></div></div> ';return n}.call(Simplite,e)},Simplite.compiles["web-pagelist-filters"]=function(e){return function(e){"use strict";var t=this,n='<form class="form-inline"><div class="form-group"><div class="dropdown"></div></div><div class="form-group"><label for="date-range">选择日期范围</label><input type="text" class="form-control" id="date-range" value="'+t.defaultAttr(e.start_date+" 到 "+e.end_date)+'"></div><div class="form-group"><button type="button" class="btn btn-default dialog">点击弹窗</button></div></form> ';return n}.call(Simplite,e)},Simplite.compiles["web-pagelist-list"]=function(e){return function(e){"use strict";var t=this,n='<div><table class="table table-hover table-bordered"><thead><tr><th>页面URL</th><th>页面名称</th><th>浏览量PV</th><th>访客数UV</th><th>IP</th></tr></thead><tbody></tbody></table></div><div class="widgets-pager"></div> ';return n}.call(Simplite,e)},Simplite.compiles["web-pagelist-list-tbody"]=function(e){return function(e){"use strict";var t=this,n="",r=r=e.list.length;if(r)for(var i=0;i<r;i++){var s=e.list[i];n+='<tr><td class="page-url"><a href="'+t.defaultAttr(s.page_url)+'" target="_blank">'+t.defaultAttr(s.page_url)+'</a><a class="trend" data-href="'+t.defaultAttr(window.rootBase+"/web/pagetrend")+'" data-url="'+t.defaultAttr(s.page_url)+'" target="_blank"><span class="glyphicon glyphicon-random"></span></a></td><td>'+t.defaultAttr(s.page_name)+"</td><td>"+t.defaultAttr(s.pvs)+"</td><td>"+t.defaultAttr(s.uvs)+"</td><td>"+t.defaultAttr(s.ips)+"</td></tr>"}else n+='<tr><td colspan="5"><center>没有数据</center></td></tr>';return n+=" ",n}.call(Simplite,e)},define("web-pagelist/main",["require","exports","module","service/web-pagelist","./filters","./list"],function(e,t){"use strict";var n=e("service/web-pagelist");e("./filters"),e("./list"),t.init=function(){var e=this.element,t=Simplite.render("web-pagelist");e.html(t)}});